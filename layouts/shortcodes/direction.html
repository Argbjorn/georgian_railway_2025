{{ $from := .Get 0 }}
{{ $to := .Get 1 }}
{{ $lang := .Page.Language.Lang }}

{{ $stations := .Site.Data.stations }}
{{ $routes := .Site.Data.routes }}

{{ $fromStation := "" }}
{{ $toStation := "" }}

<!-- Find stations by code -->
{{ range $stations }}
    {{ if eq .code $from }}
        {{ $fromStation = . }}
    {{ end }}
    {{ if eq .code $to }}
        {{ $toStation = . }}
    {{ end }}
{{ end }}

{{ if and $fromStation $toStation }}
    <!-- Routes from departure station -->
    {{ $availableRoutes := slice }}
    {{ range $fromStation.routes.departure }}
        {{ $routeRef := .ref }}
        {{ range $routes }}
            {{ if eq .ref $routeRef }}
                {{ $route := . }}
                <!-- Check if this route goes to destination -->
                {{ range .stations }}
                    {{ if eq .code $to }}
                        {{ $availableRoutes = $availableRoutes | append $route }}
                    {{ end }}
                {{ end }}
            {{ end }}
        {{ end }}
    {{ end }}

    <!-- Show routes -->
    {{ if $availableRoutes }}
        <div class="direction-routes">
            <h3>
                {{ if eq $lang "ru" }}
                    Доступные маршруты
                {{ else if eq $lang "ka" }}
                    ხელმისაწვდომი მარშრუტები
                {{ else }}
                    Available routes
                {{ end }}
            </h3>
            <ul>
                {{ range $availableRoutes }}
                    {{ $departureTime := "" }}
                    
                    <!-- Find departure time -->
                    {{ range .stations }}
                        {{ if eq .code $from }}
                            {{ $departureTime = .time }}
                        {{ end }}
                    {{ end }}
                    
                    <a href="/{{ if eq $lang "ru" }}ru/{{ else if eq $lang "ka" }}ka/{{ end }}routes/{{ .ref }}/" class="station-route">
                        <span class="station-route-time">{{ $departureTime }}</span>
                        <span class="station-route-ref">{{ .ref }}</span>
                        <span class="station-route-name">
                            {{ if eq $lang "ru" }}
                                {{ index . "name:ru" }}
                            {{ else if eq $lang "ka" }}
                                {{ index . "name:ka" }}
                            {{ else }}
                                {{ index . "name:en" }}
                            {{ end }}
                        </span>
                    </a>
                {{ end }}
            </ul>
        </div>
    {{ end }}
{{ end }}