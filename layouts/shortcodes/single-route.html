{{ $online_tickets_current_site := .Get 0 }}
{{ $online_tickets_new_site := .Get 1 }}
{{ $lang := .Get 2 }}
{{ $stations := .Page.Params.stations }}

{{ $translations := dict
    "ru" (dict
        "analogue" "–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø–æ–µ–∑–¥–∞"
        "status" "‚úÖ –ú–∞—Ä—à—Ä—É—Ç –∞–∫—Ç–∏–≤–µ–Ω. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
        "frequency" "–ß–∞—Å—Ç–æ—Ç–∞"
        "frequency_daily" "–µ–∂–µ–¥–Ω–µ–≤–Ω–æ"
        "frequency_odd_days" "–ø–æ –Ω–µ—á—ë—Ç–Ω—ã–º –¥–Ω—è–º"
        "travel_time" "–í—Ä–µ–º—è –≤ –ø—É—Ç–∏"
        "train_type" "–¢–∏–ø –ø–æ–µ–∑–¥–∞"
        "suburban_train" "—ç–ª–µ–∫—Ç—Ä–∏—á–∫–∞"
        "price" "–¶–µ–Ω–∞"
        "from" "–æ—Ç"
        "online_tickets" "–û–Ω–ª–∞–π–Ω –±–∏–ª–µ—Ç—ã"
        "available" "–¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞"
        "current_site" "–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ"
        "new_site" "–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º –±–µ—Ç–∞-—Å–∞–π—Ç–µ"
        "not_available" "–Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã"
        "uncomplete_disclaimer" "üöß –£ –º–µ–Ω—è –Ω–µ—Ç –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–±—ã—Ç–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–µ–∑–¥–∞. –ï–≥–æ –Ω–µ—Ç –∏ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ. –ï—Å–ª–∏ –≤—ã —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–æ–±—â–∏—Ç–µ –º–Ω–µ."
        "schedule" "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ"
        "back_to_map" "–ù–∞ –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É –ø–æ–µ–∑–¥–æ–≤"
        "route_on_map" "–ú–∞—Ä—à—Ä—É—Ç –Ω–∞ –∫–∞—Ä—Ç–µ"
    )
    "en" (dict
        "analogue" "Similar trains"
        "status" "‚úÖ Route is active. Last changes"
        "frequency" "Frequency"
        "frequency_daily" "daily"
        "frequency_odd_days" "on odd days"
        "travel_time" "Travel time"
        "train_type" "Train type"
        "suburban_train" "suburban"
        "price" "Price"
        "from" "from"
        "online_tickets" "Online tickets"
        "available" "available on the"
        "current_site" "official website"
        "new_site" "official website (beta)"
        "not_available" "not available"
        "uncomplete_disclaimer" "üöß I don't have a complete list of stations or arrival times for this route. Neither is it on the official website. If you have any additional information, please let me know."
        "schedule" "Schedule"
        "back_to_map" "To the entire routes map"
        "route_on_map" "Route on the map"
    )
}}

{{ $t := index $translations $lang }}

<!-- Status -->
<p>{{ $t.status }}: {{ now.Format "02.01.2006" }}</p>

<!-- Frequency -->
<p><strong>{{ $t.frequency }}:</strong> 
    {{ if eq .Page.Params.frequency "daily" }}
        {{ $t.frequency_daily }}
    {{ else if eq .Page.Params.frequency "on odd days" }}
        {{ $t.frequency_odd_days }}
    {{ else }}
        {{ if eq $lang "ru" }}
            {{ $months := dict 
                "January" "—è–Ω–≤–∞—Ä—è"
                "February" "—Ñ–µ–≤—Ä–∞–ª—è" 
                "March" "–º–∞—Ä—Ç–∞" 
                "April" "–∞–ø—Ä–µ–ª—è" 
                "May" "–º–∞—è" 
                "June" "–∏—é–Ω—è" 
                "July" "–∏—é–ª—è" 
                "August" "–∞–≤–≥—É—Å—Ç–∞" 
                "September" "—Å–µ–Ω—Ç—è–±—Ä—è" 
                "October" "–æ–∫—Ç—è–±—Ä—è" 
                "November" "–Ω–æ—è–±—Ä—è" 
                "December" "–¥–µ–∫–∞–±—Ä—è" }}
            
            {{ $frequency := .Page.Params.frequency }}
            {{ range $en, $ru := $months }}
                {{ $frequency = replace $frequency $en $ru }}
            {{ end }}
            {{ $frequency }}
        {{ else }}
            {{ .Page.Params.frequency }}
        {{ end }}
    {{ end }} <br>

<!-- Travel time -->
<strong>{{ $t.travel_time }}:</strong> {{ .Page.Params.travel_time }} <br>

<!-- Train type -->
{{ if .Page.Params.train_type }}
    <strong>{{ $t.train_type }}:</strong><button class="train-type-button" onclick="toggleTrainInfo('train-info-{{ .Page.Params.train_type }}')">{{ if eq .Page.Params.train_type "stadler" }}Stadler KISS{{ else if eq .Page.Params.train_type "vmk-grt" }}VMK/GRT{{ else if eq .Page.Params.train_type "suburban" }}{{ $t.suburban_train }}{{ end }}</button>
    <div id="train-info-{{ .Page.Params.train_type }}" class="train-info-description">
        {{ partial "shortcodes/train-description.html" (dict "lang" $lang "train_type" .Page.Params.train_type) }}
    </div>
{{ end }}

<!-- Price -->
{{ if .Page.Params.price }}
    <strong>{{ $t.price }}:</strong> {{ if eq .Page.Params.price.price_type "from" }}{{ $t.from }} {{ end }}{{ .Page.Params.price.price }} ‚Çæ<br>
{{ end }}

<!-- Online tickets -->
<strong>{{ $t.online_tickets }}:</strong> 
{{ if or (eq $online_tickets_current_site "true") (eq $online_tickets_new_site "true") }}
    {{ $t.available }} 
    {{ if eq $online_tickets_current_site "true" }}
        <a href="https://ticket.railway.ge/" target="_blank">{{ $t.current_site }}</a>
    {{ end }}
    {{ if eq $online_tickets_new_site "true" }}
        <a href="https://gr.com.ge/en" target="_blank">{{ $t.new_site }}</a>
    {{ end }}
{{ else }}{{ $t.not_available }}
{{ end }}</p>

<!-- Schedule -->
<h3>{{ $t.schedule }}</h3>
{{ if not .Page.Params.complete }}
<p>{{ $t.uncomplete_disclaimer }}</p>
{{ end }}

<ul class="route-timeline">
    {{ range $index, $station := $stations }}
    <li class="{{ if or (eq $index 0) (eq $index (sub (len $stations) 1)) }}terminal{{ else }}intermediate{{ end }}">
        <span class="station-time">{{ .time }}</span>
        <a href="/{{ if eq $lang "ru" }}ru/{{ end }}stations/{{ .code }}/" class="station-name">{{ if eq $lang "ru" }}{{ .name_ru }}{{ else }}{{ .name_en }}{{ end }}</a>
    </li>
    {{ end }}
</ul>

<!-- Analogues -->
{{ if .Page.Params.analogue }}
    <h3>{{ $t.analogue }}</h3>
    {{ range .Page.Params.analogue }}
        {{ $analogueRef := . }}
        {{ range $route := $.Site.Data.routes }}
            {{ if eq (string $route.ref) (string $analogueRef) }}
                {{ $url := printf "%s/routes/%v/" (cond (eq $lang "ru") "/ru" "") $analogueRef }}
                <a href="{{ $url }}" class="station-route">
                    <span class="station-route-ref">{{ $analogueRef }}</span>
                    <span class="station-route-name">{{ index $route (printf "name:%s" $lang) }}</span>
                </a>
            {{ end }}
        {{ end }}
    {{ end }}
{{ end }}

<!-- Route map -->
<h3>{{ $t.route_on_map }}</h3>
{{ partial "route-map.html" . }}

<p>üó∫ <a href='/{{ $lang }}/'>{{ $t.back_to_map }}</a></p>
<br>

<script>
function toggleTrainInfo(elementId) {
    const description = document.getElementById(elementId);
    if (!description) return;
    if (description.style.display === 'block') {
        description.style.display = 'none';
    } else {
        description.style.display = 'block';
    }
}
</script>