{{ $online_tickets_current_site := .Get 0 }}
{{ $online_tickets_new_site := .Get 1 }}
{{ $lang := .Get 2 }}
{{ $stations := .Page.Params.stations }}

{{ $translations := dict
    "ru" (dict
        "analogue" "Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ° Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸"
        "status" "âœ… ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½. ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ"
        "frequency" "Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°"
        "frequency_daily" "ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾"
        "frequency_every_second_day" "Ñ‡ĞµÑ€ĞµĞ· Ğ´ĞµĞ½ÑŒ"
        "travel_time" "Ğ’Ñ€ĞµĞ¼Ñ Ğ² Ğ¿ÑƒÑ‚Ğ¸"
        "train_type" "Ğ¢Ğ¸Ğ¿ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ°"
        "suburban_train" "ÑĞ»ĞµĞºÑ‚Ñ€Ğ¸Ñ‡ĞºĞ°"
        "price" "Ğ¦ĞµĞ½Ğ°"
        "from" "Ğ¾Ñ‚"
        "online_tickets" "ĞĞ½Ğ»Ğ°Ğ¹Ğ½ Ğ±Ğ¸Ğ»ĞµÑ‚Ñ‹"
        "available" "Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ½Ğ°"
        "current_site" "Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ ÑĞ°Ğ¹Ñ‚Ğµ"
        "new_site" "Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ±ĞµÑ‚Ğ°-ÑĞ°Ğ¹Ñ‚Ğµ"
        "not_available" "Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹"
        "uncomplete_disclaimer" "ğŸš§ Ğ£ Ğ¼ĞµĞ½Ñ Ğ½ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¿Ğ¸ÑĞºĞ° ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¹ Ğ¸Ğ»Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ°. Ğ•Ğ³Ğ¾ Ğ½ĞµÑ‚ Ğ¸ Ğ½Ğ° Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ ÑĞ°Ğ¹Ñ‚Ğµ. Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ñ€Ğ°ÑĞ¿Ğ¾Ğ»Ğ°Ğ³Ğ°ĞµÑ‚Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑĞ¾Ğ¾Ğ±Ñ‰Ğ¸Ñ‚Ğµ Ğ¼Ğ½Ğµ."
        "schedule" "Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ"
        "back_to_map" "ĞĞ° Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ ĞºĞ°Ñ€Ñ‚Ñƒ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ¾Ğ²"
        "route_on_map" "ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğµ"
    )
    "en" (dict
        "analogue" "Other trains in this direction"
        "status" "âœ… Route is active. Last changes"
        "frequency" "Frequency"
        "frequency_daily" "daily"
        "frequency_every_second_day" "every second day"
        "travel_time" "Travel time"
        "train_type" "Train type"
        "suburban_train" "suburban"
        "price" "Price"
        "from" "from"
        "online_tickets" "Online tickets"
        "available" "available on the"
        "current_site" "official website"
        "new_site" "official website (beta)"
        "not_available" "not available"
        "uncomplete_disclaimer" "ğŸš§ I don't have a complete list of stations or arrival times for this route. Neither is it on the official website. If you have any additional information, please let me know."
        "schedule" "Schedule"
        "back_to_map" "To the entire routes map"
        "route_on_map" "Route on the map"
    )
    "ka" (dict
        "analogue" "áƒ¡áƒ®áƒ•áƒ áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ”áƒ‘áƒ˜ áƒáƒ› áƒ›áƒ˜áƒ›áƒáƒ áƒ—áƒ£áƒšáƒ”áƒ‘áƒáƒ¨áƒ˜"
        "status" "âœ… áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ˜ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜áƒ. áƒ‘áƒáƒšáƒ áƒªáƒ•áƒšáƒ˜áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜"
        "frequency" "áƒ¡áƒ˜áƒ®áƒ¨áƒ˜áƒ áƒ”"
        "frequency_daily" "áƒ§áƒáƒ•áƒ”áƒšáƒ“áƒ¦áƒ˜áƒ£áƒ áƒáƒ“"
        "frequency_every_second_day" "áƒ—áƒ˜áƒ—áƒáƒ”áƒ£áƒšáƒ˜ áƒ›áƒ”áƒáƒ áƒ” áƒ“áƒ¦áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡"
        "travel_time" "áƒ›áƒáƒ’áƒ–áƒáƒ£áƒ áƒáƒ‘áƒ˜áƒ¡ áƒ“áƒ áƒ"
        "train_type" "áƒ›áƒáƒ¢áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ¢áƒ˜áƒáƒ˜"
        "suburban_train" "áƒ¡áƒáƒ’áƒáƒ áƒ”áƒ£áƒ‘áƒœáƒ áƒ›áƒáƒ¢áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜"
        "price" "áƒ¤áƒáƒ¡áƒ˜"
        "from" "áƒ“áƒáƒœ"
        "online_tickets" "áƒáƒœáƒšáƒáƒ˜áƒœ áƒ‘áƒ˜áƒšáƒ”áƒ—áƒ”áƒ‘áƒ˜"
        "available" "áƒ®áƒ”áƒšáƒ›áƒ˜áƒ¡áƒáƒ¬áƒ•áƒ“áƒáƒ›áƒ˜áƒ"
        "current_site" "áƒáƒ¤áƒ˜áƒªáƒ˜áƒáƒšáƒ£áƒ  áƒ¡áƒáƒ˜áƒ¢áƒ–áƒ”"
        "new_site" "áƒáƒ¤áƒ˜áƒªáƒ˜áƒáƒšáƒ£áƒ  áƒ‘áƒ”áƒ¢áƒ-áƒ¡áƒáƒ˜áƒ¢áƒ–áƒ”"
        "not_available" "áƒáƒ áƒáƒ áƒ®áƒ”áƒšáƒ›áƒ˜áƒ¡áƒáƒ¬áƒ•áƒ“áƒáƒ›áƒ˜"
        "uncomplete_disclaimer" "ğŸš§ áƒ›áƒ” áƒáƒ  áƒ›áƒáƒ¥áƒ•áƒ¡ áƒáƒ› áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ˜áƒ¡ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ¡áƒ˜áƒ áƒáƒœ/áƒ“áƒ áƒ©áƒáƒ›áƒáƒ¡áƒ•áƒšáƒ˜áƒ¡ áƒ“áƒ áƒ. áƒáƒ áƒª áƒáƒ¤áƒ˜áƒªáƒ˜áƒáƒšáƒ£áƒ  áƒ¡áƒáƒ˜áƒ¢áƒ–áƒ”áƒ. áƒ—áƒ£ áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ¤áƒšáƒáƒ‘áƒ— áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒáƒ¡, áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ›áƒáƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒáƒ—."
        "schedule" "áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜"
        "back_to_map" "áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ—áƒ áƒ¡áƒ áƒ£áƒš áƒ áƒ£áƒ™áƒáƒ–áƒ” áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ"
        "route_on_map" "áƒ›áƒáƒ áƒ¨áƒ áƒ£áƒ¢áƒ˜ áƒ áƒ£áƒ™áƒáƒ–áƒ”"
    )
}}

{{ $t := index $translations $lang }}

<!-- Status -->
<p>{{ $t.status }}: {{ now.Format "02.01.2006" }}</p>

<!-- Frequency -->
<p><strong>{{ $t.frequency }}:</strong> 
    {{ if eq .Page.Params.frequency "daily" }}
        {{ $t.frequency_daily }}
    {{ else if eq .Page.Params.frequency "every second day" }}
        {{ if .Page.Params.every_second_day_start }}
            <button class="dashed-link" data-timestamp="{{ .Page.Params.every_second_day_start }}" data-lang="{{ $lang }}">{{ $t.frequency_every_second_day }}</button>
        {{ else }}
            {{ $t.frequency_every_second_day }}
        {{ end }}
    {{ else if eq $lang "ru" }}
        {{ $months := dict 
            "January" "ÑĞ½Ğ²Ğ°Ñ€Ñ"
            "February" "Ñ„ĞµĞ²Ñ€Ğ°Ğ»Ñ" 
            "March" "Ğ¼Ğ°Ñ€Ñ‚Ğ°" 
            "April" "Ğ°Ğ¿Ñ€ĞµĞ»Ñ" 
            "May" "Ğ¼Ğ°Ñ" 
            "June" "Ğ¸ÑĞ½Ñ" 
            "July" "Ğ¸ÑĞ»Ñ" 
            "August" "Ğ°Ğ²Ğ³ÑƒÑÑ‚Ğ°" 
            "September" "ÑĞµĞ½Ñ‚ÑĞ±Ñ€Ñ" 
            "October" "Ğ¾ĞºÑ‚ÑĞ±Ñ€Ñ" 
            "November" "Ğ½Ğ¾ÑĞ±Ñ€Ñ" 
            "December" "Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ" }}
        
        {{ $frequency := .Page.Params.frequency }}
        {{ range $en, $ru := $months }}
            {{ $frequency = replace $frequency $en $ru }}
        {{ end }}
        {{ $frequency }}
    {{ else if eq $lang "ka" }}
        {{ $months := dict 
            "January" "áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜"
            "February" "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜" 
            "March" "áƒ›áƒáƒ áƒ¢áƒ˜" 
            "April" "áƒáƒáƒ áƒ˜áƒšáƒ˜" 
            "May" "áƒ›áƒáƒ˜áƒ¡áƒ˜" 
            "June" "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜" 
            "July" "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜" 
            "August" "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ" 
            "September" "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜" 
            "October" "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜" 
            "November" "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜" 
            "December" "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜" }}
        
        {{ $frequency := .Page.Params.frequency }}
        {{ range $en, $ka := $months }}
            {{ $frequency = replace $frequency $en $ka }}
        {{ end }}
        {{ $frequency }}
    {{ else }}
        {{ .Page.Params.frequency }}
    {{ end }} <br>

<!-- Travel time -->
<strong>{{ $t.travel_time }}:</strong> {{ .Page.Params.travel_time }} <br>

<!-- Train type -->
{{ if .Page.Params.train_type }}
    <strong>{{ $t.train_type }}:</strong><button class="dashed-link" onclick="toggleTrainInfo('train-info-{{ .Page.Params.train_type }}')">{{ if eq .Page.Params.train_type "stadler" }}Stadler KISS{{ else if eq .Page.Params.train_type "vmk-grt" }}VMK/GRT{{ else if eq .Page.Params.train_type "suburban" }}{{ $t.suburban_train }}{{ end }}</button>
    <div id="train-info-{{ .Page.Params.train_type }}" class="train-info-description">
        {{ partial "shortcodes/train-description.html" (dict "lang" $lang "train_type" .Page.Params.train_type) }}
    </div>
{{ end }}

<!-- Price -->
{{ if .Page.Params.price }}
    <strong>{{ $t.price }}:</strong> {{ if eq .Page.Params.price.price_type "from" }}{{ $t.from }} {{ end }}{{ .Page.Params.price.price }} â‚¾<br>
{{ end }}

<!-- Online tickets -->
<strong>{{ $t.online_tickets }}:</strong> 
{{ if or (eq $online_tickets_current_site "true") (eq $online_tickets_new_site "true") }}
    {{ $t.available }} 
    {{ if eq $online_tickets_current_site "true" }}
        <a href="https://ticket.railway.ge/" target="_blank">{{ $t.current_site }}</a>
    {{ end }}
    {{ if eq $online_tickets_new_site "true" }}
        <a href="https://gr.com.ge/en" target="_blank">{{ $t.new_site }}</a>
    {{ end }}
{{ else }}{{ $t.not_available }}
{{ end }}</p>

<!-- Schedule -->
<h3>{{ $t.schedule }}</h3>
{{ if not .Page.Params.complete }}
<p>{{ $t.uncomplete_disclaimer }}</p>
{{ end }}

<!-- Stations -->
<ul class="route-timeline">
    {{ range $index, $station := $stations }}
    <li class="{{ if or (eq $index 0) (eq $index (sub (len $stations) 1)) }}terminal{{ else }}intermediate{{ end }}">
        <span class="station-time">{{ .time }}</span>
        <a href="/{{ if eq $lang "ru" }}ru/{{ else if eq $lang "ka" }}ka/{{ end }}stations/{{ .code }}/" class="station-name">
            {{ if eq $lang "ru" }}
                {{ .name_ru }}
            {{ else if eq $lang "ka" }}
                {{ .name_ka }}
            {{ else }}
                {{ .name_en }}
            {{ end }}
        </a>
    </li>
    {{ end }}
</ul>

<!-- Analogues -->
{{ if .Page.Params.analogue }}
    <h3>{{ $t.analogue }}</h3>
    {{ range .Page.Params.analogue }}
        {{ $analogueRef := . }}
        {{ range $route := $.Site.Data.routes }}
            {{ if eq (string $route.ref) (string $analogueRef) }}
                {{ $url := printf "%s/routes/%v/" (cond (eq $lang "ru") "/ru" "") $analogueRef }}
                <a href="{{ $url }}" class="station-route">
                    <span class="station-route-ref">{{ $analogueRef }}</span>
                    <span class="station-route-name">{{ index $route (printf "name:%s" $lang) }}</span>
                </a>
            {{ end }}
        {{ end }}
    {{ end }}
{{ end }}

<!-- Route map -->
<h3>{{ $t.route_on_map }}</h3>
{{ partial "route-map.html" . }}

<p>ğŸ—º <a href='/{{ $lang }}/'>{{ $t.back_to_map }}</a></p>
<br>

<!-- Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>

<style>
.calendar-trigger {
    color: #007bff;
    cursor: pointer;
    text-decoration: underline;
}

.calendar-trigger:hover {
    color: #0056b3;
}

.flatpickr-day {
    cursor: default !important;
    border: initial !important;
}

.flatpickr-day:hover {
    background: initial !important;
    border: initial !important;
}

.flatpickr-day.selected {
    background: initial !important;
    border: initial !important;
    color: initial !important;
}

.flatpickr-day.train-day {
    background: #f0f9f0 !important;
    color: #2d5a2d !important;
    font-weight: 600 !important;
    border: initial !important;
}

.flatpickr-day.today {
    background: initial !important;
    color: initial !important;
    font-weight: 600 !important;
}

.flatpickr-day.train-day.today {
    background: #f0f9f0 !important;
    color: initial !important;
    font-weight: 600 !important;
    border: initial !important;
}

.flatpickr-day.prevMonthDay,
.flatpickr-day.nextMonthDay {
    visibility: hidden;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ²ÑĞµ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ
    const calendarTriggers = document.querySelectorAll('.dashed-link[data-timestamp]');
    
    calendarTriggers.forEach(function(trigger) {
        const timestampStr = trigger.dataset.timestamp;
        const lang = trigger.dataset.lang || 'en'; // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¸Ğ· data-Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ°
        
        // ĞŸĞ°Ñ€ÑĞ¸Ğ¼ timestamp - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Number() Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ½Ğ°ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸
        let timestamp = Number(timestampStr);
        
        // Ğ•ÑĞ»Ğ¸ timestamp Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸Ñ‚ ĞºĞ°Ğº ÑĞµĞºÑƒĞ½Ğ´Ñ‹ (Ğ¼ĞµĞ½ÑŒÑˆĞµ Ñ‡ĞµĞ¼ Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ² Ğ¼Ğ¸Ğ»Ğ»Ğ¸ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…)
        if (timestamp < 10000000000) {
            timestamp = timestamp * 1000; // ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞµĞºÑƒĞ½Ğ´Ñ‹ Ğ² Ğ¼Ğ¸Ğ»Ğ»Ğ¸ÑĞµĞºÑƒĞ½Ğ´Ñ‹
        }
        
        const startDate = new Date(timestamp);
        
        // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¼Ğ°ÑÑĞ¸Ğ² Ğ²ÑĞµÑ… Ğ´Ğ°Ñ‚ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ° (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 3 Ğ¼ĞµÑÑÑ†ĞµĞ²)
        const trainDates = [];
        const todayDate = new Date();
        todayDate.setHours(0, 0, 0, 0); // ĞĞ±Ğ½ÑƒĞ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ¾ 00:00:00.000
        const currentDate = new Date(startDate);
        const endDate = new Date(startDate);
        endDate.setMonth(endDate.getMonth() + 3); // +3 Ğ¼ĞµÑÑÑ†Ğ°
        
        while (currentDate <= endDate) {
            if (currentDate >= todayDate) {
                trainDates.push(new Date(currentDate));
            }
            currentDate.setDate(currentDate.getDate() + 2); // ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ´ĞµĞ½ÑŒ
        }
        
        // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ input Ñ€ÑĞ´Ğ¾Ğ¼ Ñ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ¾Ğ¼
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'text';
        hiddenInput.style.display = 'none';
        trigger.parentNode.insertBefore(hiddenInput, trigger.nextSibling);
        
        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Flatpickr
        const fp = flatpickr(hiddenInput, {
            animate: false,
            disableMobile: true,
            closeOnSelect: false,
            locale: lang, // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒ
            inline: false,
            dateFormat: "d.m.Y",
            minDate: "today",
            maxDate: endDate,
            monthSelectorType: "static",
            positionElement: trigger, // ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ°
            appendTo: trigger.parentNode, // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ°
            onDayCreate: function(dObj, dStr, fp, dayElem) {
                const dayDate = dayElem.dateObj;
                
                // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ ÑÑ‚Ğ¾Ñ‚ Ğ´ĞµĞ½ÑŒ Ğ´Ğ½ĞµĞ¼ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ°
                const isTrainDay = trainDates.some(function(trainDate) {
                    return trainDate.getDate() === dayDate.getDate() && 
                           trainDate.getMonth() === dayDate.getMonth() && 
                           trainDate.getFullYear() === dayDate.getFullYear();
                });
                
                if (isTrainDay) {
                    dayElem.classList.add('train-day');
                }
            }
        });
        
        // ĞŸÑ€Ğ¸ ĞºĞ»Ğ¸ĞºĞµ Ğ½Ğ° Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ
        trigger.addEventListener('click', function() {
            fp.open();
        });
    });
});

function toggleTrainInfo(elementId) {
    const description = document.getElementById(elementId);
    if (!description) return;
    if (description.style.display === 'block') {
        description.style.display = 'none';
    } else {
        description.style.display = 'block';
    }
}
</script>